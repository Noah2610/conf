#!/bin/bash
# dmenu for climer/climbar.
# Plays an audio track when timer runs out.

# shellcheck source=./util.sh
_dir="$( dirname "$0" )"
[ -f "${_dir}/util.sh" ] || bash "${_dir}/download-util.sh" || exit 1
source "${_dir}/util.sh"
unset _dir

PATH="${HOME}/.cargo/bin:${PATH}"

check "dmenu"
check "climer"

AUDIO="${HOME}/Music/Soundtracks/tetris/tetris-theme.wav"
CLIMER_MEDIA_FILE="${HOME}/.climermenu-media"

check_file "$AUDIO"

if is_available "climbar"; then
  climer_cmd="climbar"
elif is_available "climbar"; then
  climer_cmd="climbar"
else
  check "climer"
fi

if is_available "mpv"; then
  MEDIA="mpv"
elif is_available "cvlc"; then
  MEDIA="VLC_VERBOSE=0 cvlc -q"
else
  check "mpv"
fi

echo -n "$MEDIA" > "$CLIMER_MEDIA_FILE"

input="$( dmenu -p "Time:" )"

$climer_cmd $input && $MEDIA "$AUDIO"
